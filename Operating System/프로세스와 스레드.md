# 프로세스 & 스레드

<br>

> **프로세스** : 컴퓨터에서 실행되고 있는 프로그램
>
> **스레드** : 프로세스 내 실행되는 여러 흐름 단위

<br>

기본적으로 프로세스마다 최소 1개의 스레드 소유 (메인 스레드 포함)
CPU 스케줄러에 따라 CPU가 프로세스를 실행

<br>

![img](https://github.com/DDATsCS/CS_Storage/assets/99666136/bad224e3-0024-4eeb-8c6a-c6cf88b882c1)

프로세스는 각각 별도의 주소공간 할당 (독립적)

- Code : 코드 자체를 구성하는 메모리 영역(프로그램 명령)

- Data : 전역변수, 정적변수, 배열 등
  - 초기화 된 데이터는 1) data 영역에 저장
  - 초기화 되지 않은 데이터는 2) bss 영역에 저장
- Heap : 동적 할당 시 사용 (new(), malloc(), free() 등)
  - cf. 동적할당이란 런타임 단계에서 메모리를 할당받는 것

- Stack : 지역변수, 매개변수, 리턴 값 (임시 메모리 영역)

<br>

스레드는 Stack만 따로 할당 받고 나머지 영역은 서로 공유

- Stack 영역만 따로 할당 받는 이유
  - 스레드는 독립적인 동작을 수행하기 위해 존재 한다
  - 즉 독립적으로 함수를 호출 할 수 있어야 한다
  - 때문에 함수의 매개변수, 지역변수등을 저장하는 스택 메모리 영역은 독립적으로 할당 받아야 한다

<br>

하나의 프로세스가 생성될 때, 기본적으로 하나의 스레드 같이 생성

<br>

**프로세스는 자신만의 고유 공간과 자원을 할당받아 사용**하는데 반해, **스레드는 다른 스레드와 공간, 자원을 공유하면서 사용**하는 차이가 존재함

<br>

##### PCB
> 운영체제에서 프로세스에 대한 메타데이터를 저장한 데이터로, 프로세스 생성시 PCB 생성
> 프로그램이 실행되면 프로세스가 생성되고 프로세스 주소값들에 앞서 설명한 스택, 힙 등의 구조를 기반으로 메모리가 할당
> 이 프로세스의 메타데이터들이 PCB에 저장되며, 메모리 상 커널 스택의 가장 앞부분에서 관리
![img](https://github.com/DDATsCS/CS_Storage/assets/99666136/bca814a4-b8af-47f5-91fc-d3ce62f18f3e)

![img](https://github.com/DDATsCS/CS_Storage/assets/99666136/94e83d09-ca0e-41cf-8449-b7b315e146a3)

> PCB 구조
- 프로세스 스케줄링 상태
- 프로세스 ID: 프로세스 ID, 해당 프로세스의 자식 프로세스 ID
- 프로세스 권한: 컴퓨터 자원또는 I/O 디바이스에 대한 권한 정보
- 프래그램 카운터: 프로세스에서 실행해야 할 다음 명령어의 주소에 대한 포인터
- CPU 레지스터: 프로세스를 실행하기 위해 저장해야 할 레지스터에 대한 정보
- CPU 스케줄링 정보: CPU 스케줄러에 의해 중단된 시간 등에 대한 정보
- 계정 정보: 프로세스 실행에 사용된 CPU 사용량, 실행한 유저의 정보
- I/O 상태 정보: 프로세스에 할당된 I/O 디바이스 목록
<br>

<br>

##### 멀티프로세스

> 하나의 프로그램을 여러개의 프로세스로 구성하여 각 프로세스가 병렬적으로 작업을 수행하는 것

**장점** : 안전성 (메모리 침범 문제를 OS 차원에서 해결)

**단점** : 각각 독립된 메모리 영역을 갖고 있어, 작업량 많을 수록 오버헤드 발생. Context Switching으로 인한 성능 저하

<br>

***Context Switching*이란?**

> 프로세스의 상태 정보를 저장하고 복원하는 일련의 과정(= PCB를 교환하는 과정)
> 1) 할당된 시간이 끝나거나, 2) 인터럽트에 의해 발생
> 많은 프로세스가 동시에 구동되는 것처럼 보이는 것은 다른 프로세스와의 컨텍스트 스위칭이 빠르게 실행되는 것
> 현대의 컴퓨터는 멀티코어의 CPU를 가지기 때문에 한 시점에 한 개의 프로그램이라는 설명을 틀림


![img](https://github.com/DDATsCS/CS_Storage/assets/99666136/7197e175-9e44-4574-8da5-00b5299cb6fd)

- cf. 카메라(I/O 디바이스)가 시스템콜로 os에 넘어가도 실행되고 있는 것이기에 '프로세스'라고 봄

<br>

<br>

##### 멀티 스레드

> 하나의 응용 프로그램에서 여러 스레드를 구성해 각 스레드가 하나의 작업을 처리하는 것

스레드들이 공유 메모리를 통해 다수의 작업을 동시에 처리하도록 해줌

<br>

**장점** : 독립적인 프로세스에 비해 공유 메모리만큼의 시간, 자원 손실이 감소
전역 변수와 정적 변수에 대한 자료를 공유하기 때문에 효율성이 높음

**단점** : 안전성 문제. 하나의 스레드가 데이터 공간 망가뜨리면, 모든 스레드가 작동 불능 상태 (공유 메모리를 갖기 때문)

- 멀티스레드의 안전성에 대한 단점은 Critical Section 기법을 통해 대비함

  > 하나의 스레드가 공유 데이터 값을 변경하는 시점에 다른 스레드가 그 값을 읽으려할 때 발생하는 문제를 해결하기 위한 동기화 과정
  >
  > ```
  > 상호 배제, 진행, 한정된 대기를 충족해야함
  > ```
